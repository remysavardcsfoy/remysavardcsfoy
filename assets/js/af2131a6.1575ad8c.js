"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[4487],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var r=a.createContext({}),u=function(e){var t=a.useContext(r),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(r.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=o,h=p["".concat(r,".").concat(m)]||p[m]||d[m]||s;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,i=new Array(s);i[0]=m;var l={};for(var r in t)hasOwnProperty.call(t,r)&&(l[r]=t[r]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var u=2;u<s;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5118:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const s={title:"State",sidebar_label:"State",slug:"/state"},i=void 0,l={unversionedId:"State",id:"State",title:"State",description:"Definition",source:"@site/docs/08-State.md",sourceDirName:".",slug:"/state",permalink:"/docs/state",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"State",sidebar_label:"State",slug:"/state"}},r={},u=[{value:"Definition",id:"definition",level:2},{value:"State in Function Components",id:"state-in-function-components",level:2},{value:"Using the <code>useState</code> Hook",id:"using-the-usestate-hook",level:3},{value:"main.js",id:"mainjs",level:5},{value:"Setting <code>state</code>",id:"setting-state",level:2},{value:"Remember not to set <code>state</code> directly, use the setter function returned by the hook.",id:"remember-not-to-set-state-directly-use-the-setter-function-returned-by-the-hook",level:3},{value:"main.js",id:"mainjs-1",level:5},{value:"Setting <code>state</code> based on prior state",id:"setting-state-based-on-prior-state",level:3},{value:"main.js",id:"mainjs-2",level:5},{value:"How to be sure a setState call has completed?",id:"how-to-be-sure-a-setstate-call-has-completed",level:3},{value:"FAQs",id:"faqs",level:2},{value:"Using Multiple State Variables",id:"using-multiple-state-variables",level:3},{value:"Should I use one or many state variables?",id:"should-i-use-one-or-many-state-variables",level:4},{value:"Where to use <code>useState</code>",id:"where-to-use-usestate",level:3},{value:"Common State Use Case",id:"common-state-use-case",level:2},{value:"State in Class Components",id:"state-in-class-components",level:2},{value:"Using State Correctly",id:"using-state-correctly",level:2},{value:"Data Flows Down",id:"data-flows-down",level:2},{value:"Reference",id:"reference",level:2}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"definition"},"Definition"),(0,o.kt)("p",null,"A component needs state when some data associated with it changes over time. For example, a Checkbox component might need isChecked in its state, and a NewsFeed component might want to keep track of fetchedPosts in its state."),(0,o.kt)("p",null,"The most important difference between state and props is that props are passed from a parent component, but state is managed by the component itself. A component cannot change its props, but it can change its state."),(0,o.kt)("p",null,"For each particular piece of changing data, there should be just one component that \u201cowns\u201d it in its state. Don\u2019t try to synchronize states of two different components. Instead, lift it up to their closest shared ancestor, and pass it down as props to both of them.\nJust an object that lives inside a component and stores all of the data that that component and maybe some of its children need."),(0,o.kt)("p",null,"State is local to the component (encapsulated) and should not be accessed outside the component."),(0,o.kt)("h2",{id:"state-in-function-components"},"State in Function Components"),(0,o.kt)("h3",{id:"using-the-usestate-hook"},"Using the ",(0,o.kt)("inlineCode",{parentName:"h3"},"useState")," Hook"),(0,o.kt)("h5",{id:"mainjs"},"main.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function addMinutes(date, minutes) {\n  //we multiply minutes by 60000 is to convert minutes to milliseconds\n  return new Date(date.getTime() + minutes * 60000);\n}\n\nfunction Clock() {\n  const [time, setTime] = React.useState(new Date());\n\n  const handleClick = () => {\n    setTime(addMinutes(time, 10));\n  };\n\n  return (\n    <div>\n      <p>{time.toLocaleTimeString()}</p>\n      <button onClick={handleClick}>+ 10 Minutes</button>\n    </div>\n  );\n}\n\nReactDOM.createRoot(document.getElementById('root')).render(<Clock />);\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"What does calling useState do?")),(0,o.kt)("p",null,"It declares a \u201cstate variable\u201d. Our variable is called ",(0,o.kt)("inlineCode",{parentName:"p"},"time")," but we could call it anything else, like ",(0,o.kt)("inlineCode",{parentName:"p"},"basketball"),". This is a way to \u201cpreserve\u201d some values between the function calls \u2014 ",(0,o.kt)("inlineCode",{parentName:"p"},"useState")," is a new way to use the exact same capabilities that this.state provides in a class. Normally, variables \u201cdisappear\u201d when the function exits but state variables are preserved by React."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"What do we pass to useState as an argument?")),(0,o.kt)("p",null,"The only argument to the ",(0,o.kt)("inlineCode",{parentName:"p"},"useState()")," Hook is the ",(0,o.kt)("inlineCode",{parentName:"p"},"initial state"),". Unlike with classes, the state doesn\u2019t have to be an object. We can keep a number or a string if that\u2019s all we need. In our example, we just want a date object to show the time, so we pass the a new date object (now) as initial state for our variable. (If we wanted to store two different values in state, we would call useState() twice.)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"What does useState return?")),(0,o.kt)("p",null,"It returns a pair of values: the current state and a function that updates it. This is why we write const ","[date, setDate]"," = useState(...). This is similar to ",(0,o.kt)("inlineCode",{parentName:"p"},"this.state.count")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"this.setState")," in a class, except you get them in a pair."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"What is that syntax?")),(0,o.kt)("p",null,"The syntax for ",(0,o.kt)("inlineCode",{parentName:"p"},"useState")," is confusing at first because it uses ",(0,o.kt)("strong",{parentName:"p"},"Array destructuring")," to return a pair. Array destructuring is used because it allows the us to decide what the variable and setter function should be named."),(0,o.kt)("h2",{id:"setting-state"},"Setting ",(0,o.kt)("inlineCode",{parentName:"h2"},"state")),(0,o.kt)("h3",{id:"remember-not-to-set-state-directly-use-the-setter-function-returned-by-the-hook"},"Remember not to set ",(0,o.kt)("inlineCode",{parentName:"h3"},"state")," directly, use the setter function returned by the hook."),(0,o.kt)("h5",{id:"mainjs-1"},"main.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function addMinutes(date, minutes) {\n  //we multiply minutes by 60000 is to convert minutes to milliseconds\n  return new Date(date.getTime() + minutes * 60000);\n}\n\nfunction Clock() {\n  let [time, setTime] = React.useState(new Date());\n\n  const handleClick = () => {\n    //doesn't update the DOM\n    time = addMinutes(time, 10);\n    //updates the DOM\n    // setTime(addMinutes(time, 10));\n  };\n\n  return (\n    <div>\n      <p>{time.toLocaleTimeString()}</p>\n      <button onClick={handleClick}>+ 10 Minutes</button>\n    </div>\n  );\n}\n\nReactDOM.createRoot(document.getElementById('root')).render(<Clock />);\n")),(0,o.kt)("h3",{id:"setting-state-based-on-prior-state"},"Setting ",(0,o.kt)("inlineCode",{parentName:"h3"},"state")," based on prior state"),(0,o.kt)("p",null,"Setting ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," based on prior state requires passing a function to the updater function that returns the new value instead of just passing the new value."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"So if the new state is computed using the previous state...pass a function to your updater function (setX function). The function will receive the previous value, and return an updated value.")),(0,o.kt)("h5",{id:"mainjs-2"},"main.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function addMinutes(date, minutes) {\n  return new Date(date.getTime() + minutes * 60000);\n}\n\nfunction Clock() {\n  const [time, setTime] = React.useState(new Date());\n\n  const handleClick1 = () => {\n    setTime(addMinutes(time, 10));\n    setTime(addMinutes(time, 10));\n  };\n\n  const handleClick2 = () => {\n    setTime((previousTime) => addMinutes(previousTime, 10));\n    setTime((previousTime) => addMinutes(previousTime, 10));\n  };\n\n  return (\n    <div>\n      <p>{time.toLocaleTimeString()}</p>\n      <button onClick={handleClick1}>+ 10 Minutes</button>\n      <button onClick={handleClick2}>+ 10 Minutes</button>\n    </div>\n  );\n}\n\nReactDOM.createRoot(document.getElementById('root')).render(<Clock />);\n")),(0,o.kt)("p",null,"This is not an issue until you attempt to read state soon after you have set it (setting state repeatedly is an easy way to the issue). The issue arises because React does state updates asyncronously and can batch them to improve rendering performance."),(0,o.kt)("h3",{id:"how-to-be-sure-a-setstate-call-has-completed"},"How to be sure a setState call has completed?"),(0,o.kt)("p",null,"Use a ",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect")," hook with a dependency on the the state variable that is changing. We will learn about ",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect")," in the next chapter."),(0,o.kt)("h2",{id:"faqs"},"FAQs"),(0,o.kt)("h3",{id:"using-multiple-state-variables"},"Using Multiple State Variables"),(0,o.kt)("p",null,"Declaring state variables as a pair of ",(0,o.kt)("inlineCode",{parentName:"p"},"[something, setSomething]")," is also handy because it lets us give different names to different state variables if we want to use more than one:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function ExampleWithManyStates() {\n  // Declare multiple state variables!\n  const [age, setAge] = useState(42);\n  const [fruit, setFruit] = useState('banana');\n  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]);\n  ...\n}\n")),(0,o.kt)("p",null,"In the above component, we have ",(0,o.kt)("inlineCode",{parentName:"p"},"age"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"fruit"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"todos")," as local variables, and we can update them individually:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function handleOrangeClick() {\n  // Similar to this.setState({ fruit: 'orange' })\n  setFruit('orange');\n}\n")),(0,o.kt)("p",null,"You don\u2019t have to use many state variables. State variables can hold objects and arrays just fine, so you can still group related data together. However, unlike ",(0,o.kt)("inlineCode",{parentName:"p"},"this.setState")," in a class, updating a state variable always replaces it instead of merging it."),(0,o.kt)("h4",{id:"should-i-use-one-or-many-state-variables"},"Should I use one or many state variables?"),(0,o.kt)("p",null,"If you\u2019re coming from classes, you might be tempted to always call ",(0,o.kt)("inlineCode",{parentName:"p"},"useState()")," once and put all state into a single object. You can do it if you\u2019d like. Here is an example of a component that follows the mouse movement. We keep its position and size in the local state:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function Box() {\n  const [state, setState] = useState({\n    left: 0,\n    top: 0,\n    width: 100,\n    height: 100,\n  });\n  // ...\n}\n")),(0,o.kt)("p",null,"Now let\u2019s say we want to write some logic that changes left and top when the user moves their mouse. Note how we have to merge these fields into the previous state object manually:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'...\nconst handleWindowMouseMove(e) {\n      // Spreading "...state" ensures we don\'t "lose" width and height\n      setState(state => ({ ...state, left: e.pageX, top: e.pageY }));\n}\n...\n')),(0,o.kt)("p",null,"This is because when we update a state variable, we replace its value. This is different from ",(0,o.kt)("inlineCode",{parentName:"p"},"this.setState")," in a class, which ",(0,o.kt)("em",{parentName:"p"},"merges")," the updated fields into the object."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The React team recommends to split state into multiple state variables based on which values tend to change together.")),(0,o.kt)("p",null,"For example, we could split our component state into position and size objects, and always replace the position with no need for merging:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function Box() {\n  const [position, setPosition] = useState({ left: 0, top: 0 });\n  const [size, setSize] = useState({ width: 100, height: 100 });\n\n  const handleWindowMouseMove(e) {\n      setPosition({ left: e.pageX, top: e.pageY });\n }\n ...\n}\n")),(0,o.kt)("h3",{id:"where-to-use-usestate"},"Where to use ",(0,o.kt)("inlineCode",{parentName:"h3"},"useState")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"In Classes"),(0,o.kt)("th",{parentName:"tr",align:null},"With Hooks"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"this.setState"),(0,o.kt)("td",{parentName:"tr",align:null},"useState")))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("inlineCode",{parentName:"p"},"useState")," don\u2019t work inside classes. But you can use function components with hooks instead of class components and ",(0,o.kt)("inlineCode",{parentName:"p"},"setState"),".")),(0,o.kt)("h2",{id:"common-state-use-case"},"Common State Use Case"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { useState } = React;\n\nfunction App() {\n  const [loading, setLoading] = useState(false);\n  const [data, setData] = useState([]);\n  function loadData() {\n    setLoading(true);\n    setTimeout(() => {\n      setLoading(false);\n      setData([1, 2, 3, 4]);\n    }, 3000);\n  }\n\n  return (\n    <>\n      {loading && <p>Loading...</p>}\n      <pre>{JSON.stringify(data, null, ' ')}</pre>\n      <button onClick={loadData}>Load Data</button>\n    </>\n  );\n}\n\nReactDOM.createRoot(document.getElementById('root')).render(<App />);\n")),(0,o.kt)("h2",{id:"state-in-class-components"},"State in Class Components"),(0,o.kt)("p",null,"In React, you don\u2019t manipulate the DOM directly, instead you simply update data (state) and let React react by updating the UI in all the needed places."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"class Clock extends React.Component {\n  state = {\n    time: new Date().toLocaleTimeString(),\n  };\n\n  handleClick = () => {\n    this.setState({ time: new Date().toLocaleTimeString() });\n  };\n\n  render() {\n    return (\n      <div>\n        <p>{this.state.time}</p>\n        <button onClick={handleClick}>Refresh</button>\n      </div>\n    );\n  }\n}\n\nReactDOM.createRoot(document.getElementById('root')).render(<Clock />);\n")),(0,o.kt)("h2",{id:"using-state-correctly"},"Using State Correctly"),(0,o.kt)("p",null,"There are three things you should know about setState()."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Do Not Modify State Directly"),(0,o.kt)("li",{parentName:"ol"},"State Updates :")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In class components, ",(0,o.kt)("inlineCode",{parentName:"li"},"setState")," keeps previous state you do not change"),(0,o.kt)("li",{parentName:"ul"},"In function components, the ",(0,o.kt)("inlineCode",{parentName:"li"},"useState")," updater function ",(0,o.kt)("inlineCode",{parentName:"li"},"set...")," does not keep previous state. It is overwritten.")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"State Updates May Be Asynchronous"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"React may batch multiple set...() calls into a single update for performance.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Because ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," may be updated asynchronously (after an http request or a user action like clicking a button ), you should not rely on current state values for calculating the next state."))))),(0,o.kt)("h2",{id:"data-flows-down"},"Data Flows Down"),(0,o.kt)("p",null,"Neither parent nor child components can know if a certain component is stateful or stateless, and they shouldn\u2019t care whether it is defined as a function or a class."),(0,o.kt)("p",null,"This is why state is often called local or encapsulated. It is not accessible to any component other than the one that owns and sets it."),(0,o.kt)("p",null,"A component may choose to pass its state down as props to its child components:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"<h2>It is {this.state.date.toLocaleTimeString()}.</h2>\n")),(0,o.kt)("p",null,"This also works for user-defined components:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"<FormattedDate date={this.state.date} />\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"FormattedDate")," component would receive the ",(0,o.kt)("inlineCode",{parentName:"p"},"date")," in its props and wouldn't know whether it came from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Clock"),"'s state, from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Clock"),"'s props, or was typed by hand:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"function FormattedDate(props) {\n  return <h2>It is {props.date.toLocaleTimeString()}.</h2>;\n}\n")),(0,o.kt)("p",null,'This is commonly called a "top-down" or "unidirectional" data flow. Any state is always owned by some specific component, and any data or UI derived from that state can only affect components "below" them in the tree.'),(0,o.kt)("p",null,"If you imagine a component tree as a waterfall of props, each component's state is like an additional water source that joins it at an arbitrary point but also flows down."),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/state-and-lifecycle.html"},"State and Lifecycle")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/glossary.html#state"},"Glossary Definition: State")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/hooks-state.html"},"Using the State Hook"))))}d.isMDXComponent=!0}}]);