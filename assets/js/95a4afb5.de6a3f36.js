"use strict";(self.webpackChunkreact=self.webpackChunkreact||[]).push([[6617],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),l=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(i.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(n),m=o,g=u["".concat(i,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(g,s(s({ref:t},p),{},{components:n})):r.createElement(g,s({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c[u]="string"==typeof e?e:o,s[1]=c;for(var l=2;l<a;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8127:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>l});var r=n(7462),o=(n(7294),n(3905));const a={title:"Lab 26: Custom Hooks"},s=void 0,c={unversionedId:"labs/ts/CustomHooks",id:"labs/ts/CustomHooks",title:"Lab 26: Custom Hooks",description:"This lab is optional and should only be done if time permits",source:"@site/docs/labs/ts/26-CustomHooks.md",sourceDirName:"labs/ts",slug:"/labs/ts/CustomHooks",permalink:"/docs/labs/ts/CustomHooks",draft:!1,tags:[],version:"current",sidebarPosition:26,frontMatter:{title:"Lab 26: Custom Hooks"}},i={},l=[{value:"Objectives",id:"objectives",level:2},{value:"Steps",id:"steps",level:2},{value:"<code>srcprojectsProjectsPage.ts</code>",id:"srcprojectsprojectspagets",level:4},{value:"\u2714 You have completed Lab 26",id:"-you-have-completed-lab-26",level:3}],p={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This lab is optional and should only be done if time permits")),(0,o.kt)("h2",{id:"objectives"},"Objectives"),(0,o.kt)("ul",{className:"contains-task-list"},(0,o.kt)("li",{parentName:"ul",className:"task-list-item"},(0,o.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Move stateful logic out of components by creating Custom Hooks")),(0,o.kt)("h2",{id:"steps"},"Steps"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"This lab is a refactor of the code from the solution of ",(0,o.kt)("inlineCode",{parentName:"p"},"lab22")," so begin by checking out the ",(0,o.kt)("inlineCode",{parentName:"p"},"lab22")," solution code and creating a working branch for this lab."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"git checkout lab22\ngit checkout -b lab26working\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a ",(0,o.kt)("inlineCode",{parentName:"p"},"projectHooks.ts")," file and add the following code."),(0,o.kt)("h4",{parentName:"li",id:"srcprojectsprojecthooksts"},(0,o.kt)("inlineCode",{parentName:"h4"},"src\\projects\\projectHooks.ts")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { useState, useEffect } from 'react';\nimport { projectAPI } from './projectAPI';\nimport { Project } from './Project';\n\nexport function useProjects() {\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | undefined>(undefined);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [saving, setSaving] = useState(false);\n  const [savingError, setSavingError] = useState<string | undefined>(\n    undefined\n  );\n\n  useEffect(() => {\n    async function loadProjects() {\n      setLoading(true);\n      try {\n        const data = await projectAPI.get(currentPage);\n        if (currentPage === 1) {\n          setProjects(data);\n        } else {\n          setProjects((projects) => [...projects, ...data]);\n        }\n      } catch (e) {\n        if (e instanceof Error) {\n          setError(e.message);\n        }\n      } finally {\n        setLoading(false);\n      }\n    }\n    loadProjects();\n  }, [currentPage]);\n\n  const saveProject = (project: Project) => {\n    setSaving(true);\n    projectAPI\n      .put(project)\n      .then((updatedProject) => {\n        let updatedProjects = projects.map((p) => {\n          return p.id === project.id ? new Project(updatedProject) : p;\n        });\n        setProjects(updatedProjects);\n      })\n      .catch((e) => {\n        setSavingError(e.message);\n      })\n      .finally(() => setSaving(false));\n  };\n\n  return {\n    projects,\n    loading,\n    error,\n    currentPage,\n    setCurrentPage,\n    saving,\n    savingError,\n    saveProject,\n  };\n}\n")),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"Notice how this logic was directly lifted out of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProjectsPage")," component."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Refactor the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProjectsPage")," component to remove the logic which is now in the hook and call the hook instead."))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Be sure to open the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProjectsPage.tsx")," and not the singular ",(0,o.kt)("inlineCode",{parentName:"p"},"ProjectPage.tsx"))),(0,o.kt)("h4",{id:"srcprojectsprojectspagets"},(0,o.kt)("inlineCode",{parentName:"h4"},"src\\projects\\ProjectsPage.ts")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"-import React, { useState, useEffect } from 'react';\n+import React from 'react';\n import ProjectList from './ProjectList';\n-import { projectAPI } from './projectAPI';\n-import { Project } from './Project';\n+import { useProjects } from './projectHooks';\n\nfunction ProjectsPage() {\n-  const [projects, setProjects] = useState<Project[]>([]);\n-  const [loading, setLoading] = useState(false);\n-  const [error, setError] = useState<string | undefined>(undefined);\n-  const [currentPage, setCurrentPage] = useState(1);\n-  const [saving, setSaving] = useState(false);\n-  const [savingError, setSavingError] = useState<string | undefined>(undefined);\n\n\n\n\n-  useEffect(() => {\n-    async function loadProjects() {\n-      setLoading(true);\n-      try {\n-        const data = await projectAPI.get(currentPage);\n-        if (currentPage === 1) {\n-          setProjects(data);\n-        } else {\n-          setProjects((projects) => [...projects, ...data]);\n-        }\n-      } catch (e) {\n-         if (e instanceof Error) {\n-          setError(e.message);\n-        }\n-      } finally {\n-        setLoading(false);\n-      }\n-    }\n-    loadProjects();\n-  }, [currentPage]);\n\n+  const {\n+    projects,\n+    loading,\n+    error,\n+    setCurrentPage,\n+    saveProject,\n+    saving,\n+    savingError,\n+  } = useProjects();\n\n   const handleMoreClick = () => {\n     setCurrentPage((currentPage) => currentPage + 1);\n   };\n\n-  const saveProject = (project: Project) => {\n-    projectAPI\n-      .put(project)\n-      .then((updatedProject) => {\n-        let updatedProjects = projects.map((p) => {\n-          return p.id === project.id ? new Project(updatedProject) : p;\n-        });\n-        setProjects(updatedProjects);\n-      })\n-      .catch((e) => {\n-        if (e instanceof Error) {\n-          setError(e.message);\n-        }\n-      });\n-  };\n\n   return (\n     <>\n       <h1>Projects</h1>\n+      {saving && <span className=\"toast\">Saving...</span>}\n\n-      {error && (\n+      {(error || savingError) && (\n         <div className=\"row\">\n           <div className=\"card large error\">\n             <section>\n               <p>\n                 <span className=\"icon-alert inverse \"></span>\n-                {error}\n+                {error} {savingError}\n               </p>\n             </section>\n           </div>\n    </>\n  );\n}\n\nexport default ProjectsPage;\n\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Test the application to verify the loading, saving and error messages are displaying."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Add this line to test the loading spinner"),(0,o.kt)("h4",{parentName:"li",id:"srcprojectsprojectapits"},(0,o.kt)("inlineCode",{parentName:"h4"},"src\\projects\\projectAPI.ts")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"  get(page = 1, limit = 20) {\n    return fetch(`${url}?_page=${page}&_limit=${limit}&_sort=name`)\n+     .then(delay(2000))\n      .then(checkStatus)\n      .then(parseJSON)\n      .catch((error: TypeError) => {\n        console.log('log client error ' + error);\n        throw new Error(\n          'There was an error retrieving the projects. Please try again.'\n        );\n      });\n  },\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Shut down your backend API to test the display of an error message")))))),(0,o.kt)("h3",{id:"-you-have-completed-lab-26"},"\u2714"," You have completed Lab 26"))}d.isMDXComponent=!0}}]);